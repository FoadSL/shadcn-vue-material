# Maintenance Guide: shadcn-vue-material Registry

## Table of Contents
1. [Project Overview](#project-overview)
2. [Architecture & Structure](#architecture--structure)
3. [Key Concepts](#key-concepts)
4. [Build System](#build-system)
5. [Sync Process](#sync-process)
6. [Material Design Integration](#material-design-integration)
7. [Custom Components Workflow](#custom-components-workflow)
8. [Registry System](#registry-system)
9. [Development Workflow](#development-workflow)
10. [Deployment](#deployment)
11. [Important Files & Scripts](#important-files--scripts)
12. [Best Practices](#best-practices)
13. [Documenting Custom Components](#documenting-custom-components)
14. [Troubleshooting](#troubleshooting)

---

## Project Overview

This is a **custom shadcn-vue registry** that:
- Serves components in **JavaScript** (not TypeScript) for broader compatibility
- Integrates **Material Design 3** design tokens via the `@vira/material-design-css` package
- Stays **synced with upstream** shadcn-vue while allowing custom overrides
- Provides a **JS-first development workflow** for custom components

### Key Differences from Upstream
- **Language**: Components are converted to JS (TS → JS conversion)
- **Design System**: Uses Material Design 3 tokens instead of default shadcn theme
- **Customization**: Supports custom JS components in `custom/registry/` that override upstream components

---

## Architecture & Structure

```
shadcn-vue-material/
├── registry/              # Upstream TS components (synced, don't edit)
│   ├── new-york-v4/      # Component source files from shadcn-vue
│   └── index.ts          # Registry index (TypeScript)
│
├── custom/               # Custom JS-first components (never synced)
│   └── registry/         # Your custom overrides and new components
│       └── new-york-v4/  # JS versions of components
│
├── packages/             # Local packages
│   └── material-design-css/  # Material Design 3 CSS library
│
├── public/               # Built output (deploy this)
│   └── r/
│       └── styles/
│           └── new-york-v4/  # JSON files for each component
│
├── scripts/              # Build and sync scripts
│   ├── build.js         # Main build script
│   ├── sync-from-upstream.js  # Sync from shadcn-vue
│   ├── convert-source-to-js.js  # Convert TS → JS
│   └── detype-vue-sfc.js  # Remove TS from Vue SFCs
│
├── playground/          # Preview site (Nuxt app)
│   └── v4/              # Nuxt v4 playground
│
├── registry.json        # Registry manifest (defines all components)
├── components.json     # shadcn-vue config
└── package.json        # Dependencies
```

### Directory Purposes

- **`registry/`**: Upstream TypeScript components. **Never edit directly** - overwritten by `pnpm sync`
- **`custom/registry/`**: Your custom JavaScript components. **Safe to edit** - never touched by sync
- **`public/r/`**: Built JSON files served to consumers. Generated by `pnpm build:js`
- **`packages/material-design-css/`**: Material Design 3 design tokens and utilities

---

## Key Concepts

### 1. Registry System

shadcn-vue uses a **registry-based component system**:
- Components are defined in `registry.json` as **items**
- Each item has a `name`, `type`, `files[]`, `dependencies`, etc.
- The build process converts these items into JSON files in `public/r/styles/new-york-v4/`
- Consumers use `npx shadcn-vue add @registry/component-name` to install components

### 2. Component Types

From `registry.json`, items can have these types:
- `registry:ui` - UI components (Button, Input, etc.)
- `registry:block` - Complex multi-file components (dashboards, forms)
- `registry:lib` - Utility libraries (utils, helpers)
- `registry:hook` - Composables (useForm, useToast)
- `registry:component` - Simple single-file components
- `registry:style` - Style definitions (CSS variables, themes)

### 3. File Path Resolution

In `registry.json`, file paths are relative to the repo root:
```json
{
  "files": [
    {
      "path": "registry/new-york-v4/ui/button/Button.vue",
      "type": "registry:ui"
    }
  ]
}
```

To override a component, change the path to point to `custom/registry/...`:
```json
{
  "files": [
    {
      "path": "custom/registry/new-york-v4/ui/button/Button.vue",
      "type": "registry:ui"
    }
  ]
}
```

---

## Build System

### Build Commands

```bash
# Build TypeScript registry (default)
pnpm build

# Build JavaScript registry (recommended)
pnpm build:js
```

### Build Process (`scripts/build.js`)

1. **Runs shadcn-vue build**: Executes `npx shadcn-vue build registry.json -o public/r/styles/new-york-v4`
   - Reads `registry.json`
   - Processes all items and their files
   - Outputs JSON files with component code embedded

2. **Converts TS → JS** (if `--js` flag):
   - Uses `@unovue/detypes` to strip TypeScript syntax
   - Removes `lang="ts"` from Vue SFCs
   - Converts `.ts` → `.js`, `.tsx` → `.jsx` in file paths
   - Strips type imports and type annotations

### Output Format

Each component becomes a JSON file:
```json
{
  "$schema": "https://shadcn-vue.com/schema/registry-item.json",
  "name": "button",
  "type": "registry:ui",
  "dependencies": ["reka-ui"],
  "files": [
    {
      "path": "components/ui/button/Button.vue",
      "content": "<script setup>...</script><template>...</template>",
      "type": "registry:ui"
    }
  ]
}
```

---

## Registry (base + custom)

The registry includes the full shadcn-vue catalog plus your custom and overridden components. Extensions (e.g. animations, icons) can declare `registryDependencies` on base components and resolve correctly.

- **Sync** updates only the `registry/` folder (upstream source). It does not modify `registry.json`.
- **Adding components:** Add entries to `registry.json` when you add or override a component in `custom/registry/`. Override an existing item by changing its `files[].path` to `custom/registry/...`; add new items (e.g. `button-material`) alongside the base catalog.

---

## Sync Process

### Syncing from Upstream

```bash
# Sync from upstream shadcn-vue (updates registry/ folder only)
pnpm sync

# With custom upstream path
UPSTREAM_PATH=/path/to/shadcn-vue pnpm sync
```

### What Sync Does (`scripts/sync-from-upstream.js`)

- **Copies registry source only:** `shadcn-vue/apps/v4/registry/` → `registry/` (overwrites `registry/`).
- **Does not touch `registry.json`.** Use the updated `registry/` as reference or to copy new components into `custom/registry/`, then add or update the item in `registry.json`.

### After Sync

Rebuild if you changed any source used by your registry items:
```bash
pnpm sync
pnpm build:js
```

---

## Material Design Integration

### Design System Package

The `packages/material-design-css/` package provides:
- **Material Design 3 tokens** (colors, typography, shape, motion, elevation)
- **TailwindCSS v4 integration** via `@theme` directive
- **Configurable via CSS variables** (`--md-config-*`)

### Token System

Three-tier configuration:
1. **`--md-config-*`** - Your project configuration (highest priority)
2. **`--md-sys-*`** - System tokens (resolved from config or defaults)
3. **`--color-*`, `--radius-*`** - Final Tailwind values

### Integration in Playground

The playground (`playground/v4/assets/css/main.css`) bridges shadcn semantic vars to MD3:

```css
:root {
  /* Bridge shadcn → Material Design */
  --background: var(--md-sys-color-surface);
  --foreground: var(--md-sys-color-on-surface);
  --primary: var(--md-sys-color-primary);
  --primary-foreground: var(--md-sys-color-on-primary);
  /* ... */
}
```

This allows shadcn components to use Material Design tokens transparently.

### Using Material Design Tokens

Components can use MD3 utilities:
- Colors: `bg-primary`, `text-on-primary`, `bg-surface-container`
- Shape: `rounded-medium`, `rounded-large`
- Typography: `display-large`, `body-medium`
- Motion: `transition-button`, `ease-emphasized`

---

## Custom Components Workflow

### Creating a Custom Component

1. **Copy from upstream** (if overriding):
   ```bash
   # Copy component files
   cp -r registry/new-york-v4/ui/button custom/registry/new-york-v4/ui/button
   ```

2. **Convert to JS**:
   ```bash
   # Convert TS files to JS
   pnpm convert:source:js
   
   # Or manually remove TypeScript:
   # - Remove `lang="ts"` from Vue SFCs
   # - Remove type annotations
   # - Convert .ts → .js
   ```

3. **Customize**:
   - Edit component files in `custom/registry/`
   - Apply Material Design classes
   - Modify behavior/logic as needed

4. **Update registry.json**:
   ```json
   {
     "name": "button",
     "type": "registry:ui",
     "files": [
       {
         "path": "custom/registry/new-york-v4/ui/button/Button.vue",
         "type": "registry:ui"
       }
     ]
   }
   ```

5. **Build**:
   ```bash
   pnpm build:js
   ```

### Adding a New Component

1. Create component files in `custom/registry/new-york-v4/ui/my-component/`
2. Add entry to `registry.json`:
   ```json
   {
     "name": "my-component",
     "type": "registry:ui",
     "dependencies": ["reka-ui"],
     "files": [
       {
         "path": "custom/registry/new-york-v4/ui/my-component/MyComponent.vue",
         "type": "registry:ui"
       }
     ]
   }
   ```
3. Build: `pnpm build:js`

### JS-First Development

- Write all custom components in **JavaScript** (no TypeScript)
- Use `pnpm detype:vue` to strip TS from Vue SFCs if needed
- Keep component APIs compatible with upstream (same props, slots)

---

## Registry System

### registry.json Structure

`registry.json` contains the full shadcn-vue catalog plus any custom or overridden items. Base components use paths under `registry/new-york-v4/`; overrides and new components use `custom/registry/new-york-v4/`.

```json
{
  "name": "my-shadcn-registry",
  "homepage": "https://github.com/YOUR_ORG/my-shadcn-registry",
  "items": [
    { "name": "index", "type": "registry:style", "registryDependencies": ["utils"], "files": [] },
    { "name": "style", "type": "registry:style", "registryDependencies": ["utils"], "files": [] },
    {
      "name": "button",
      "type": "registry:ui",
      "files": [{ "path": "registry/new-york-v4/ui/button/Button.vue", "type": "registry:ui" }, ...]
    },
    {
      "name": "button-material",
      "type": "registry:ui",
      "files": [{ "path": "custom/registry/new-york-v4/ui/button/Button.vue", "type": "registry:ui" }, ...]
    },
    { "name": "utils", "type": "registry:lib", "files": [{ "path": "registry/new-york-v4/lib/utils.ts", "type": "registry:lib" }] }
  ]
}
```

### Item Properties

- **`name`**: Component identifier (used in CLI: `npx shadcn-vue add @registry/button`)
- **`type`**: Component type (see [Component Types](#2-component-types))
- **`dependencies`**: npm packages required
- **`registryDependencies`**: Other registry items this depends on (e.g. extensions depending on base components)
- **`files`**: Array of file definitions
  - `path`: Relative path from repo root (`registry/...` or `custom/registry/...`)
  - `type`: File type (usually same as item type)
  - `target`: (optional) Output path for `registry:file` types

### File Paths

- **Base components**: `registry/new-york-v4/...` (synced from upstream)
- **Custom/overrides**: `custom/registry/new-york-v4/...`
- **Built output**: Paths are rewritten to `components/ui/...` in built JSON

### Root vs Playground Registry

- **Root registry** (repo root): `registry.json` defines the full catalog (shadcn-vue + custom). Items point to `registry/new-york-v4/...` or `custom/registry/new-york-v4/...`. Used by `pnpm build` / `pnpm build:js` to produce `public/r/`.
- **Playground registry**: The playground **does not read root `registry.json`**. It has its own `playground/v4/registry/` (files on disk + `registry/index.ts`). Running `pnpm registry:build` from `playground/v4` crawls that folder and builds `__index__.ts` and `public/r/styles/new-york-v4/registry.json` from it. Keep the playground registry in sync with what you need for the preview site (e.g. by copying or syncing files into `playground/v4/registry/new-york-v4/` as your process requires).

---

## Development Workflow

### Daily Development

1. **Start with sync** (if upstream changed):
   ```bash
   pnpm sync
   ```

2. **Make changes**:
   - Edit files in `custom/registry/` (for customizations)
   - Edit `registry.json` (to add/override components)

3. **Build and test**:
   ```bash
   pnpm build:js
   pnpm serve:public  # Test built registry locally
   ```

4. **Test in playground** (playground uses its own registry; it does not read root `registry.json`):
   ```bash
   cd playground/v4
   pnpm registry:build   # build __index__.ts and registry JSON from playground registry
   pnpm dev
   ```

### Testing Custom Components

1. Build registry: `pnpm build:js`
2. Serve registry: `pnpm serve:public` (runs on port 4173)
3. In playground or test app, configure `components.json`:
   ```json
   {
     "registries": {
       "@mycompany": "http://localhost:4173/r/styles/new-york-v4/{name}.json"
     }
   }
   ```
4. Install component: `npx shadcn-vue add @mycompany/button`

---

## Deployment

### Build for Production

```bash
# Build JavaScript registry
pnpm build:js

# Output is in public/r/styles/new-york-v4/
```

### Deploy Options

Deploy the `public/r/` directory to any static host:

- **GitHub Pages**: Push `public/r/` to `gh-pages` branch
- **Netlify/Vercel**: Set build output to `public/r/`
- **CDN**: Upload `public/r/` to your CDN

### Registry URL Format

After deployment, components are available at:
```
https://your-domain.com/r/styles/new-york-v4/{component-name}.json
```

Example:
- `https://your-domain.com/r/styles/new-york-v4/button.json`
- `https://your-domain.com/r/styles/new-york-v4/alert-dialog.json`

### Consumer Setup

Users add to their `components.json`:
```json
{
  "registries": {
    "@mycompany": "https://your-domain.com/r/styles/new-york-v4/{name}.json"
  }
}
```

Then install:
```bash
npx shadcn-vue add @mycompany/button
```

---

## Important Files & Scripts

### Core Files

- **`registry.json`**: Registry manifest (full catalog + custom/overridden components)
- **`components.json`**: shadcn-vue config (for playground)
- **`package.json`**: Dependencies and scripts

### Scripts

| Script | Purpose |
|--------|---------|
| `pnpm build` | Build TS registry |
| `pnpm build:js` | Build JS registry (converts TS → JS) |
| `pnpm sync` | Sync `registry/` folder from upstream (does not change `registry.json`) |
| `pnpm convert:source:js` | Convert all registry files to JS in `custom/registry/` |
| `pnpm detype:vue` | Remove TS from Vue SFCs in `custom/registry/` |
| `pnpm serve:public` | Serve built registry locally (port 4173) |

### Key Directories

- **`registry/`**: Upstream source (TypeScript) - **read-only**
- **`custom/registry/`**: Custom source (JavaScript) - **editable**
- **`public/r/`**: Built output - **deploy this**
- **`packages/material-design-css/`**: Design system package

---

## Best Practices

### 1. Never Edit `registry/` Directly

Files in `registry/` are overwritten by `pnpm sync`. Always use `custom/registry/` for changes.

### 2. Keep Component APIs Compatible

When overriding components, maintain the same props, slots, and events as upstream. This ensures:
- Easy migration between upstream and custom versions
- Consistent developer experience
- Compatibility with examples and documentation

### 3. Use Material Design Tokens

Prefer Material Design utilities over custom classes:
- ✅ `bg-primary` (MD3 token)
- ❌ `bg-blue-500` (hardcoded color)

### 4. Test After Sync

Always rebuild and test after syncing:
```bash
pnpm sync
pnpm build:js
# Test in playground or test app
```

### 5. Version Control Custom Items

Track custom items in `registry.json`:
- Custom items are preserved during sync
- Document why each custom item exists
- Consider adding comments or metadata

### 6. Incremental Customization

Start with upstream components, then gradually customize:
1. Use upstream as-is
2. Copy to `custom/registry/` when you need changes
3. Update `registry.json` to point to custom version
4. Customize incrementally

### 7. Document Custom Components

See [Documenting Custom Components](#documenting-custom-components) below for the recommended approach.

### 8. Keep Dependencies Updated

Regularly update:
- `shadcn-vue` (via sync)
- `@unovue/detypes` (for TS → JS conversion)
- Other dependencies in `package.json`

---

## Documenting Custom Components

As the maintainer of this registry, keep custom and overridden components easy to understand for future contributors. Use these practices together.

### 1. Registry-level list (single source of truth)

Maintain a short list of which registry items are custom or overridden, and why.

- **Approach 1:** A file in the repo root or `docs/`, e.g. `docs/CUSTOM_ITEMS.md`, with a table:

  | Name | Type | Kind | Reason |
  |------|------|------|--------|
  | button | registry:ui | Override | MD3 styling, state layer |
  | sidebar-material | registry:ui | New | Internal design system |

  “Kind” can be **Override** (same name as upstream, we point to `custom/registry/`) or **New** (no upstream counterpart). Update this file whenever you add or remove a custom item or change why it exists.

- **Approach 2:** If you use an apply-overrides script, keep the list of overridden names there and add a short comment or separate doc that explains why each is overridden.

This gives one place to answer “what do we maintain ourselves?”

### 2. Per-component README

For each custom or overridden component, add a small `README.md` next to the component (e.g. `custom/registry/new-york-v4/ui/button/README.md`) with:

- **Purpose:** One line (e.g. “Material 3–styled override of upstream Button.”).
- **What’s different:** Bullet list (e.g. “Uses MD3 tokens, state layer, motion; same props/slots as upstream.”).
- **Design tokens:** Which tokens or utilities from `@vira/material-design-css` (or your theme) this component uses.
- **Breaking changes:** Any props, slots, or events that differ from upstream, or “None – API matches upstream.”

This keeps the “why” and “what changed” next to the code.

### 3. In-code comment

At the top of the main Vue/JS file of a custom component, add a short comment, e.g.:

```js
/**
 * Custom Button for Vira/MD3. Override of upstream button; same props/slots.
 * See README in this folder for details.
 */
```

That helps anyone opening the file without reading the README first.

### 4. Changelog or ADR (optional but useful)

When you introduce or change a custom component, add a line to your CHANGELOG or a short ADR (Architecture Decision Record), e.g. “We override Button for Material 3; we do not maintain a full fork of the registry.” That records intent for future maintainers and new team members.

### 5. PR/release checklist

In your PR template or release checklist, add an item: “If you added or changed a custom registry item, update the custom-items list and the component README.” That keeps documentation in sync with code changes.

---

## Troubleshooting

### Build Fails

1. Check `registry.json` syntax (valid JSON)
2. Verify all file paths exist
3. Check for TypeScript errors in source files
4. Run `pnpm sync` to ensure registry is up to date

### Sync Issues

1. Verify upstream path: `UPSTREAM_PATH=/path/to/shadcn-vue pnpm sync`
2. Check that upstream has `apps/v4/registry/` directory
3. Ensure `registry.json` is valid before sync

### Component Not Found

1. Verify component exists in `registry.json`
2. Check file paths are correct
3. Rebuild: `pnpm build:js`
4. Check built output in `public/r/styles/new-york-v4/`

### TypeScript in Output

If JS build still contains TypeScript:
1. Check `@unovue/detypes` is working
2. Manually remove TS from problematic files
3. Use `pnpm detype:vue` for Vue SFCs

---

## Additional Resources

- **shadcn-vue docs**: https://www.shadcn-vue.com/docs/registry
- **Registry schema**: https://shadcn-vue.com/schema/registry.json
- **Material Design 3**: https://m3.material.io/
- **TailwindCSS v4**: https://tailwindcss.com/docs

---

## Quick Reference

```bash
# Sync upstream source (registry/ only; registry.json unchanged)
pnpm sync
pnpm build:js          # Build JS registry
pnpm serve:public      # Test locally

# Add or override a component
cp -r registry/new-york-v4/ui/button custom/registry/new-york-v4/ui/button
pnpm detype:vue        # If needed
# Edit files in custom/registry/...
# Add or update the item in registry.json (paths under custom/registry/ for overrides)
pnpm build:js

# Deploy
pnpm build:js
# Deploy public/r/ to static host
```

---

*Last updated: Based on codebase analysis, February 2026*
